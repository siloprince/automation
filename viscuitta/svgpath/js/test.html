<html>
    <head>
        <meta charset="UTF-8"/>
        <script type="module" src="./svgpath.js">
        </script>
        <script type="module">
        'use strict';
        import { SvgPath, pathParse } from './svgpath.js';
        let pathes = [];
        let linea = 'M40, 50C47.833333333333336,52.166666666666664 67,63 87,63C107,63 160,50 160,50';
        let lineb = 'M40, 50 160,50';
        let linec = reverse(linea);
        let transformed = [];
        let hash = {};

        transformed.push(SvgPath(linea).translate(-100,-50).scale(1./1.2).rotate( 0).translate(  0,-50).toString());

        let pathstr = transformed.toString();
        let pstate = pathParse(pathstr);
        console.dir(pstate);
        let sx =  Math.floor(pstate.segments[0][0]);
        let sy =  Math.floor(pstate.segments[0][1]);
        let ss = `${sx},${sy}`;
        let ex =  Math.floor(pstate.segments[pstate.segments.length-1][0]);
        let ey =  Math.floor(pstate.segments[pstate.segments.length-1][1]);
        let ee = `${ex},${ey}`;
        if (ss!==ee) {
            hash[ss] = { path: pathstr  };
            hash[ee] = { path: reverse(pathstr)};
        }

        transformed.push(SvgPath(lineb).translate(-100,-50).scale(1./1.2).scale(1.).rotate(90).translate( 50,  0).toString());
        transformed.push(SvgPath(linec).translate(-100,-50).scale(1./1.2).scale(1.).rotate( 0).translate(  0, 50).toString());
        transformed.push(SvgPath(lineb).translate(-100,-50).scale(1./1.2).scale(1.).rotate(90).translate(-50,  0).toString());
        pathes.push(`<path d="${transformed.toString()}" fill="none" stroke="#000000" stroke-width="2"/>`);

        console.dir(transformed);
        let svgstr = `<svg width="800" height="800">
            <g transform="translate(200,200)">
            ${pathes.join('')}
            </g>
        </svg>`;
        document.querySelector('div#svg').insertAdjacentHTML('afterend',svgstr);

        function reverse(pathstr) {
            let pstate = pathParse(pathstr);
            let segments = pstate.segments;
            let ret = [];
            if (segments[0][0]!=='M') {
                throw 'invalid path:'+pathstr;
            }
            let cmd;
            let data = ['M'];
            for (let si=0;si<segments.length;si++) {
                let sj=segments.length-1-si;
                let seg = segments[sj];
                cmd = seg[0];
                let scount=0;
                for (let sk=seg.length-2;sk>0;sk-=2) {
                    let xx=seg[sk];
                    let yy=seg[sk+1];
                    if (sj!==0 && scount===1) {
                       data.push(cmd); 
                    }
                    data.push(`${xx},${yy} `);
                    scount++;
                }
            }
            return data.join('');
        }
        </script>
    </head>
    <body>
        <div id="svg" style="margin:100"></div>
    </body>
</html>