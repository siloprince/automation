<html>
<meta charset="UTF-8" /></head>
<body>

    <div style="margin:10px;">
        <svg id="red" class="draw" width="200" height="250" style="border: 1px solid #ffaaaa;" />
        <svg id="blue" class="draw" width="200" height="250" style="border: 1px solid #aaaaff;" />
        <br/>
        <input id="extrude" type="range" min="50" value="100" max="400" step="1" />: 引き伸ばし
        <br/>
    </div>
    <script type="module" src="./svgpath.js"></script>
    <script type="module" src="draw.js"></script>
    <script type="module">
        'use strict';

        import { SvgPath, pathParse, pathListMerge } from './svgpath.js';
        (function (console, document) {
            let base = 100;

            update();
            document.querySelector('input#extrude').addEventListener('change', update);
            let draws = document.querySelectorAll('svg.draw');
            for (let di=0;di<draws.length;di++) {
                draws[di].addEventListener('mouseup', update);
            }
            function update() {
                let extrude = parseFloat(document.querySelector('input#extrude').value);

                let len = base + extrude;
                let move = base / Math.sqrt(2);
                let scale = extrude / Math.sqrt(2) / base;

        let pathes = [];
        let linea = document.querySelector('g#curve_red path').getAttribute('d');
        let lineb = document.querySelector('g#curve_blue path').getAttribute('d');
        let l0 = SvgPath(linea).scale(2).toString();
        let l1 = SvgPath(lineb).scale(2).toString();

        let atile = [];
        atile.push(SvgPath(l0).rotate(   0).translate(   0,-len).toString());
        atile.push(SvgPath(l0).rotate(  90).translate( len,   0).toString());
        atile.push(SvgPath(l0).rotate(   0).translate(   0, len).toString());
        atile.push(SvgPath(l0).rotate(  90).translate(-len,   0).toString());


        let acap = SvgPath(l1).rotate( 135).translate(move,move).scale(scale).translate(-len,-len).toString();
        atile.push(SvgPath(acap).rotate( -90).toString());
        atile.push(SvgPath(acap).rotate(   0).toString());
        atile.push(SvgPath(acap).rotate(  90).toString());
        atile.push(SvgPath(acap).rotate( 180).toString());
        
        let tile = [];
        tile.push(SvgPath(l0).rotate(   0).translate(   0, -len).toString());
        tile.push(SvgPath(l0).rotate( -90).translate( len,    0).toString());
        tile.push(SvgPath(l0).rotate( 180).translate(   0,  len).toString());
        tile.push(SvgPath(l0).rotate(  90).translate(-len,    0).toString());

        let cap = SvgPath(l1).rotate( 135).translate(move,move).scale(scale).translate(-len,-len).toString();
        tile.push(SvgPath(cap).rotate( -90).toString());

        let smallStrList = [];
        smallStrList.push(SvgPath(l1).rotate( 225).translate(-move, move).toString());
        smallStrList.push(SvgPath(l1).rotate( -45).translate(-move,-move).toString());
        smallStrList.push(SvgPath(l1).rotate(  45).translate( move,-move).toString());

        let small = SvgPath(pathListMerge(smallStrList)).scale(scale).translate(-len,-len).toString();
    
        tile.push(SvgPath(small).rotate(   0).toString());
        tile.push(SvgPath(small).rotate(  90).toString());
        tile.push(SvgPath(small).rotate( 180).toString());
        
        let atile_d = pathListMerge(atile);
        console.log(atile_d);
        let tile_d = pathListMerge(tile);
        pathes.push(getPath( tile_d, -90, -len*2,     0));
        pathes.push(getPath(atile_d,   0, -len*2, len*2));
        pathes.push(getPath(atile_d,   0,      0,     0));
        pathes.push(getPath( tile_d,   0,  len*2,     0));
        pathes.push(getPath( tile_d,   0,      0, len*2));
        pathes.push(getPath(atile_d, 180,  len*2, len*2));
        pathes.push(getPath( tile_d,   0, -len*2, len*4));
        pathes.push(getPath(atile_d, 180,      0, len*4));
        pathes.push(getPath( tile_d,  90,  len*2, len*4));



        let svgstr = `<svg width="1500" height="1500">
        <g transform="translate(400,200)scale(0.4)">
        ${pathes.join('')}
        </g>
    </svg>`;
        document.querySelector('div#svg').insertAdjacentHTML('afterend', svgstr);

            }

        function getPath(data,rot,tx,ty,stroke) {
            if (rot===null) {
                rot = 0;
            }
            if (tx===null) {
                tx = 0;
            }
            if (ty===null) {
                ty = 0;
            }
            if (!stroke) {
                stroke = '#000000';
            }
            return `<path d="${data}" fill="none" stroke="${stroke}" stroke-width="2" transform="translate(${tx},${ty})rotate(${rot})"/>`;
        }
        })(console,document);
    </script>
    <div id="svg"></div>
</body>

</html>