<html>

<head>
    <meta charset="UTF-8" />
    <script type="text/javascript" src="./lib/svgpath.js"></script>
    <script type="text/javascript" src="./lib/draw.js"></script>
    <script type="text/javascript" src="./lib/update.js"></script>
    <script type="text/javascript" src="./lib/svgdownload.js"></script>
    <script type="text/javascript" src="./lib/tess.js"></script>
</head>

<body>

    <div style="margin:10px;">
        <input id="height" class="update" type="range" min="10" value="20" max="200" step="1" />: 高さ<br/>
        <input id="decenter" class="update" type="range" min="0" value="30" max="200" step="1" />: ずれ<br/>
        <input id="scale" class="update" type="range" min="0.7" value="0.9" max="1" step="0.01" />: スケール<br/>
        <input id="size" class="update" type="range" min="1" value="3" max="500" step="1" />: サイズ
        <br/>
        <a class="download">ダウンロード</a>
    </div>
    <script type="text/javascript">
        'use strict';
        (function (console, document, me) {
            let unit = 100;
            Update.update = update;
            function update(param) {
                let height = param.height;
                let decenter = param.decenter;
                let scale = param.scale;
                let size = param.size;
                let aaa = [0, 0];
                let bbb = [unit, 0];
                let ccc = [unit / 2 + decenter, height];
                let tile = [];
                tile.push(`M ${aaa[0]},${aaa[1]} ${bbb[0]},${bbb[1]}`);
                tile.push(`M ${aaa[0]},${aaa[1]} ${ccc[0]} ${ccc[1]}`);
                tile.push(`M ${ccc[0]},${ccc[1]} ${bbb[0]} ${bbb[1]}`);

                let lena = Math.sqrt(height * height + (unit / 2 - decenter) * (unit / 2 - decenter));
                let lenb = unit;
                let lenc = Math.sqrt(height * height + (unit / 2 + decenter) * (unit / 2 + decenter));
                let angle = Math.acos((lenb * lenb + lenc * lenc - lena * lena) / (2 * lenb * lenc)) * 180 / Math.PI;
                let tilepath = Tess.makePath(tile);
                let tx = unit - scale * lenc;
                let ty = 0;

                let svglist =[tilepath];
                /*
                let mat = new Matrix().translate(tx, ty).scale(scale,scale).rotate(-angle,0,0);

                for (let si = 0; si < size; si++) {
                    svglist.push(tilepath);
                    let tile = [];
                    aaa = mat.calc(aaa[0], aaa[1]);
                    bbb = mat.calc(bbb[0], bbb[1]);
                    ccc = mat.calc(ccc[0], ccc[1]);
                    tile.push(`M ${aaa[0]},${aaa[1]} ${bbb[0]},${bbb[1]}`);
                    tile.push(`M ${aaa[0]},${aaa[1]} ${ccc[0]} ${ccc[1]}`);
                    tile.push(`M ${ccc[0]},${ccc[1]} ${bbb[0]} ${bbb[1]}`);
                    tilepath = Tess.makePath(tile);
                }
                */
                for (let si = 0; si < size; si++) {
                    tilepath = `<g transform="translate(${tx},${ty})rotate(${-angle})scale(${scale})">`+tilepath+`</g>`;
                    svglist.push(tilepath);

                }
                let svgstr = `<svg width="2000" height="2000">
                        <g transform="translate(200,700)scale(4)">${svglist.join('')}</g></svg>`;

                Tess.svg(me, svgstr);
            }
        })(console, document, document.currentScript);
    </script>
</body>

</html>